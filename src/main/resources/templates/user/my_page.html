<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/common_headers :: commonHeader}">
  <meta charset="UTF-8">
  <title>ë§ˆì´í˜ì´ì§€</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tickethub: {
              DEFAULT: '#FF6F3C',
              dark: '#e65b25'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-100 min-h-screen py-10">
<div th:replace="~{fragments/top_bar :: top_bar}"></div>
<div class="max-w-5xl mx-auto px-4">
  <h1 class="text-3xl font-bold text-center mb-10 text-tickethub">ğŸŸï¸ TICKETHUB ë§ˆì´í˜ì´ì§€</h1>

  <!-- ë¡œê·¸ì¸ëœ ì‚¬ìš©ì í™”ë©´ -->
  <div th:if="${username != null}" class="space-y-10">

    <div class="bg-white shadow-md rounded-lg p-6">
      <p class="text-lg font-medium mb-2"><strong>ë¡œê·¸ì¸ ì‚¬ìš©ì:</strong> <span th:text="${username}">ì‚¬ìš©ì ì´ë¦„</span></p>
      <a href="/signout" class="text-sm text-red-500 hover:underline">ë¡œê·¸ì•„ì›ƒ</a>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">ì˜ˆë§¤ ë‚´ì—­ í™•ì¸</h2>
      <a href="/users/books" class="inline-block px-5 py-2 bg-tickethub text-white rounded hover:bg-tickethub-dark">ì˜ˆë§¤ ë‚´ì—­ ë³´ê¸°</a>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">ì¢‹ì•„ìš”í•œ ê³µì—° ëª©ë¡</h2>
      <ul id="liked-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></ul>

      <div class="flex justify-center items-center mt-6 gap-4">
        <button id="prev-btn" class="px-4 py-2 bg-tickethub text-white text-sm rounded hover:bg-tickethub-dark disabled:opacity-50">ì´ì „</button>
        <span id="page-info" class="text-sm text-gray-700"></span>
        <button id="next-btn" class="px-4 py-2 bg-tickethub text-white text-sm rounded hover:bg-tickethub-dark disabled:opacity-50">ë‹¤ìŒ</button>
      </div>
    </div>
  </div>

  <!-- ë¡œê·¸ì¸ ì•ˆ ëœ ì‚¬ìš©ì -->
  <div th:if="${username == null}" class="text-center bg-white shadow-md rounded-lg p-6">
    <p class="text-lg mb-4">ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
    <a href="/users/signin" class="text-tickethub hover:underline">ë¡œê·¸ì¸</a> í›„ ì´ìš©í•´ì£¼ì„¸ìš”.
  </div>
</div>

<script>
  let currentPage = 0;
  const size = 5;

  function loadLikes(page) {
    fetch(`/users/likes?page=${page}&size=${size}`)
    .then(response => response.json())
    .then(data => {
      const list = document.getElementById("liked-list");
      list.innerHTML = "";

      data.content.forEach(perf => {
        const li = document.createElement("li");
        li.className = "border rounded-lg shadow hover:shadow-md bg-white overflow-hidden cursor-pointer transition hover:scale-[1.02]";
        li.addEventListener("click", () => {
          window.location.href = `/performances/${perf.id}`;
        });

        li.innerHTML = `
            <img src="${perf.urlPrefix + perf.encodedFileName}" alt="${perf.title}" class="w-full h-40 object-cover">
            <div class="p-4">
              <h4 class="font-semibold text-lg">${perf.title}</h4>
              <p class="text-sm text-gray-600 mt-2">ê¸°ê°„: ${perf.startTime} ~ ${perf.endTime}</p>
              <p class="text-sm text-gray-600">ì¥ì†Œ: ${perf.placeName}</p>
            </div>
          `;
        list.appendChild(li);
      });

      document.getElementById("page-info").innerText = `í˜ì´ì§€ ${data.number + 1} / ${data.totalPages}`;
      document.getElementById("prev-btn").disabled = data.first;
      document.getElementById("next-btn").disabled = data.last;
      currentPage = data.number;
    });
  }

  document.getElementById("prev-btn").addEventListener("click", () => {
    if (currentPage > 0) {
      loadLikes(currentPage - 1);
    }
  });

  document.getElementById("next-btn").addEventListener("click", () => {
    loadLikes(currentPage + 1);
  });

  loadLikes(currentPage);
</script>

</body>
</html>
