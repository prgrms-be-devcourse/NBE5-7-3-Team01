<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${performanceDetail.title}">ê³µì—° ìƒì„¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tickethub: {
              DEFAULT: '#FF6F3C',
              dark: '#e65b25'
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-100 min-h-screen py-10 px-6">
<a href="/admin/performances" class="text-sm text-gray-700 hover:underline flex items-center mb-6">&larr; ê³µì—° ëª©ë¡ìœ¼ë¡œ</a>
<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-2xl shadow-xl p-10 grid grid-cols-1 lg:grid-cols-3 gap-10">
    <!-- ê³µì—° í¬ìŠ¤í„° -->
    <div class="col-span-1 text-center">
      <img th:src="@{'/uploads/' + ${performanceDetail.encodedFileName}}" alt="ê³µì—° í¬ìŠ¤í„°" class="mx-auto max-h-96 rounded-md shadow-md" />
    </div>

    <!-- ê³µì—° ì •ë³´ -->
    <div class="col-span-1 lg:col-span-1">
      <h2 class="text-4xl font-bold text-tickethub mb-4" th:text="${performanceDetail.title}">ê³µì—° ì œëª©</h2>
      <p class="mb-2 text-gray-700" th:text="${performanceDetail.description}">ê³µì—° ì„¤ëª…</p>
      <p class="mb-1"> ì¥ì†Œ: <span class="font-semibold" th:text="${performanceDetail.placeName}"></span></p>
      <p class="mb-1"> ì˜ˆë§¤ ìƒíƒœ: <span class="font-semibold" th:text="${performanceDetail.performanceStatus} ? 'ì˜ˆë§¤ ê°€ëŠ¥' : 'ì˜ˆë§¤ ë¶ˆê°€'"></span></p>
      <p class="mb-1"> ì‹œì‘: <span class="text-sm" th:text="${#temporals.format(performanceDetail.startTime, 'yyyy-MM-dd HH:mm')}"></span></p>
      <p class="mb-4"> ì¢…ë£Œ: <span class="text-sm" th:text="${#temporals.format(performanceDetail.endTime, 'yyyy-MM-dd HH:mm')}"></span></p>

      <div class="mb-4">
        <h4 class="font-bold mb-2">ì¢Œì„ ë“±ê¸‰ ë° ê°€ê²©</h4>
        <ul class="list-disc pl-5 text-sm text-gray-800">
          <li th:each="grade : ${performanceDetail.seatGrades}">
            <span th:text="${grade.grade}"></span>ì„ -
            <span th:text="${#numbers.formatInteger(grade.defaultPrice, 3, 'COMMA')}"></span>ì›
            (<span th:text="${grade.seatCount}"></span>ì„)
          </li>
        </ul>
      </div>

      <div class="flex gap-4">
        <a th:href="@{/admin/performances/update/{performanceId}(performanceId=${performanceId})}"
           th:if="${!(performanceDetail.deletedFlag)}"
           class="bg-tickethub hover:bg-tickethub-dark text-white px-4 py-2 rounded">ìˆ˜ì •</a>

        <button id="deleteBtn"
                th:if="${!(performanceDetail.deletedFlag)}"
                th:attr="data-id=${performanceId}"
                class="bg-tickethub hover:bg-tickethub-dark text-white px-4 py-2 rounded">ì‚­ì œ</button>
      </div>
    </div>

    <!-- ì¢Œì„ ìƒíƒœ -->
    <div class="col-span-1">
      <h3 class="text-xl font-semibold mb-4">ğŸŸï¸ ì¢Œì„ ìƒíƒœ</h3>
      <div class="flex flex-col gap-1" id="seat-container"></div>
    </div>
  </div>
</div>

<script th:inline="javascript">
  const seats = [[${seats}]];
  const seatContainer = document.getElementById("seat-container");
  const seatsPerRow = 10;

  function renderSeats() {
    seatContainer.innerHTML = '';
    for (let i = 0; i < seats.length; i += seatsPerRow) {
      const rowDiv = document.createElement("div");
      rowDiv.className = "flex gap-1 mb-1";

      for (let j = 0; j < seatsPerRow && i + j < seats.length; j++) {
        const seat = seats[i + j];
        const seatBtn = document.createElement("button");
        seatBtn.className = `w-10 h-10 text-sm border rounded ${seat.seatStatus === 'AVAILABLE' ? 'bg-purple-300' : 'bg-gray-400'} text-white`;
        seatBtn.innerText = seat.seatNumber;
        seatBtn.disabled = true;
        rowDiv.appendChild(seatBtn);
      }
      seatContainer.appendChild(rowDiv);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderSeats();

    const deleteBtn = document.getElementById("deleteBtn");
    if (deleteBtn) {
      deleteBtn.addEventListener("click", () => {
        const performanceId = deleteBtn.dataset.id;
        if (!confirm("ì •ë§ ì´ ê³µì—°ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`/api/performances/${performanceId}`, { method: 'DELETE' })
        .then(response => {
          if (!response.ok) return response.text().then(text => { throw new Error(text); });
          alert("ê³µì—°ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          window.location.href = "/admin/performances";
        })
        .catch(error => alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message));
      });
    }
  });
</script>
</body>
</html>
